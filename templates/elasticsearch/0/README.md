龙渊 Elasticsearch cluster
---

# 集群部署架构说明

采用 master、data、client 分离部署的模式

master 会部署在拥有 `es-master` 主机标签的节点上, 用作集群信息维护,自身不存放数据，建议部署3个以上的奇数master节点

data 会部署在拥有 `es-data` 主机标签的节点上, 用作数据存放，其数据卷通过es-storge的从容器进行挂载，节点数量根据需要进行配置

client 会部署在拥有 `es-client` 主机标签的节点上， 用于客户端连接(前面可接负载均衡器,或者直接在主机上暴露端口)，节点数量根据需要进行配置

如果主机节点没有相关标签， 对应模块部署会失败

master和client会尽量避免被部署在同一个节点主机， 但启动的容器数大于满足要求的节点主机数的话，还是允许部署的，data容器则一定不会被部署在同一台节点主机上，如果data容器数大于满足要求的节点主机数, 部署会失败

默认情况下，各es部件的容器会启动一个`es-sysctl`的从容器，以调整 `vm.max_map_count` 的值至262144， 如果节点主机已经进行了设置，可以关闭这个功能

# 调优选项说明

`master_heap_size`: 暂无生产环境运行配置经验，官方推荐512M-4G， 目前默认配置为1G，可根据实际压力情况进行调整

`data_heap_size`: 这个要根据节点主机的内存进行配置，龙渊32G的机器目前配置为22G，不一定合理，可根据实际压力情况进行调整

`client_heap_size`: 暂无生产环境运行配置经验，根据实际压力情况进行调整， 目前默认配置为1G

# 集群维护

TODO
